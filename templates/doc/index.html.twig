{% extends 'base.html.twig' %}

{% block title %}Документация{% endblock %}

{% block body %}
    <div class="container">

        <h1 id="v3">API</h1>

        <p class="mb-0"><b>Оглавление</b></p>
        <ul>
            <li><a href="#словарь-терминов">Словарь терминов</a></li>
            <li><a href="#принцип-работы">Принцип работы</a></li>
            <li><a href="#api">Методы API</a></li>
            <li><a href="#widget">Интеграция html-виджета для сайтов</a></li>
        </ul>

        <br>

        <h1 id="словарь-терминов">Словарь терминов</h1>
        <h2 id="платформа">Платформа</h2>
        <p>Платформа — это Тестодром и его API, предоставляющие доступ клиенту к тестированию и просмотру
            результатов.</p>
        <h2 id="клиент">Клиент</h2>
        <p>Клиент — это зарегистрированный на платформе сайт или приложение, которое взаимодействует с платформой от
            имени своих
            пользователей.</p>
        <h2 id="пользователь">Пользователь</h2>
        <p>Пользователь — это лицо в системе клиента, обладающее уникальным идентификатором. Для платформы один
            зарегистрированный
            пользователь соответствует одной выданной лицензии. Платформа предоставляет результаты тестов только если
            они
            ассоциированы с пользователем. Поэтому платформе необходимо знать ID пользователя. В качестве ID
            пользователя могут
            использоваться также email, ID сессии, IP-адрес и т.д.</p>
        <h2 id="лицензия">Лицензия</h2>
        <p>Лицензия — это разрешение, предоставляющее пользователю право быть ассоциированным с результатами
            теста. Количество результатов пользователя в рамках одной лицензии регулирует политика лицензий.</p>
        <h2 id="платёжная-политика">Платёжная политика</h2>
        <ol>
            <li><em>Политика предоплаты</em> — это модель взаимодействия клиента с платформой, при которой установлен
                лимит на количество
                выдаваемых лицензий. Увеличение лимита становится возможным после внесения оплаты.
            </li>
            <li><em>Политика постоплаты</em> — это модель взаимодействия клиента с платформой, при которой отсутствует
                предварительный лимит
                на лицензий. Оплата за выданные доступы производится по факту, на основании количества выданных
                лицензий.
            </li>
        </ol>
        <h2 id="лицензионная-политика">Лицензионная политика</h2>
        <p><em>Лицензионная политика</em> регулирует количество результатов, которые могут быть ассоциированы с
            пользователем в рамках
            одной лицензии.</p>
        <hr>
        <h1 id="принцип-работы">Принцип работы</h1>
        <h2 id="регистрация-клиента">Регистрация клиента</h2>
        <p>Клиент регистрируется на платформе и получает постоянный ключ доступа — CLIENT_KEY. При регистрации клиент
            принимает <a
                    href="#%D0%BF%D0%BB%D0%B0%D1%82%D1%91%D0%B6%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0">платёжную
                политику</a>, а также <a
                    href="#%D0%BB%D0%B8%D1%86%D0%B5%D0%BD%D0%B7%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0">лицензионную
                политику</a>.
            Регистрация клиента происходит по заявкам вручную. Напишите нам на почту: <a
                    href="mailto:&#x69;&#110;&#102;&#111;&#64;&#x70;&#114;&#111;&#x66;&#x67;&#117;&#x69;&#x64;&#x65;&#46;&#114;&#117;">&#x69;&#110;&#102;&#111;&#64;&#x70;&#114;&#111;&#x66;&#x67;&#117;&#x69;&#x64;&#x65;&#46;&#114;&#117;</a>.
        </p>
        <h2 id="прохождение-теста">Прохождение теста</h2>
        <p>Клиент <a
                    href="#%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B0">запрашивает</a>
            у платформы описание теста и <a
                    href="#%D0%B2%D0%BE%D0%BF%D1%80%D0%BE%D1%81%D1%8B-%D0%BA-%D1%82%D0%B5%D1%81%D1%82%D1%83">вопросы</a>
            к
            нему. Эти данные доступны без специального разрешения. В процессе прохождения теста клиент накапливает
            ответы
            пользователя. По достижению конца теста клиент <a
                    href="#%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-resultkey-1">отправляет
                ответы</a>
            пользователя на
            платформу в специальном формате с целью их сохранения.</p>
        <h2 id="сохранение-ответов-и-получение-result_key">Сохранение ответов и получение RESULT_KEY</h2>
        <p>Клиент <a
                    href="#%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-resultkey-1">сохраняет
                ответы</a> пользователя на платформе и получает RESULT_KEY.
            Однако результат всё ещё не ассоциирован с пользователем, поэтому его нельзя получить. Для ассоциации
            результата с
            пользователем необходимо выполнить <a
                    href="#%D0%B0%D1%81%D1%81%D0%BE%D1%86%D0%B8%D0%B0%D1%86%D0%B8%D1%8F-%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0-%D1%81-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%BC">следующий
                шаг</a>.</p>
        <h2 id="ассоциация-результата-с-пользователем">Ассоциация результата с пользователем</h2>
        <p>Клиент <a
                    href="#%D0%B0%D1%81%D1%81%D0%BE%D1%86%D0%B8%D0%B0%D1%86%D0%B8%D1%8F-%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0-%D1%81-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%BC-1">отправляет
                специальный запрос</a> на ассоциацию результата с
            пользователем, включая RESULT_KEY и <a
                    href="#%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C">идентификатор
                пользователя</a>.
            Платформа регистрирует пользователя, предварительно проверяя условия <a
                    href="#%D0%BF%D0%BB%D0%B0%D1%82%D1%91%D0%B6%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0">платёжной
                политики</a> (
            например, достаточно ли лицензий доступно для использования). Для ассоциации результата
            проверяется <a
                    href="#%D0%BB%D0%B8%D1%86%D0%B5%D0%BD%D0%B7%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0">Лицензионная
                политика</a> (например, не превышает ли пользователь лимит по
            результатам). Если
            условия не выполняются, платформа может отклонить регистрацию или ассоциацию.</p>
        <h2 id="получение-результата">Получение результата</h2>
        <p>Клиент может <a
                    href="#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0-1">запрашивать
                результаты</a> теста любое количество раз, используя RESULT_KEY.</p>
        <hr>

        <h1 id="api">API</h1>
        <h2 id="описание-теста">Получение описания теста и вопросов к нему</h2>
        <p>Описание теста не ограничено правами.</p>
        <p><strong>URL</strong>: <code>GET /tests/api/v1/info/{test}/</code></p>
        <h3 id="параметры">Параметры:</h3>
        <ul>
            <li><code>questions</code> (необязательный): <code>true</code>|<code>false</code>. Значение по умолчанию
                <code>false</code>. Добавляет к данным все вопросы из теста.
            </li>
        </ul>
        <h3 id="результат">Результат:</h3>
        <ul>
            <li><strong>Код состояния:</strong> 200 ОК</li>
            <li><strong>Пример успешного ответа:</strong></li>
        </ul>
        <pre><code class="language-json">{
  &quot;name&quot;: &quot;Тест на профориентацию&quot;,
  &quot;description&quot;: &quot;&lt;div&gt;Описание теста&lt;\/div&gt;&quot;,
  &quot;instruction&quot;: null,
  &quot;authors&quot;: [
    {
      &quot;name&quot;: &quot;ПрофГид&quot;
    }
  ],
  &quot;duration&quot;: 20,
  &quot;length&quot;: 125,
  &quot;paid&quot;: true,
  &quot;questions&quot;: {
    &quot;910&quot;: {
      &quot;id&quot;: 910,
      &quot;type&quot;: &quot;option&quot;,
      &quot;name&quot;: &quot;Нравится ли вам анализировать язык тела и интонации собеседника во время общения?&quot;,
      &quot;text&quot;: null,
      &quot;img&quot;: null,
      &quot;count&quot;: null,
      &quot;gradient&quot;: 0,
      &quot;timer&quot;: 0,
      &quot;wrong&quot;: null,
      &quot;correct&quot;: null,
      &quot;enabledBack&quot;: true,
      &quot;enabledForward&quot;: false,
      &quot;showAnswer&quot;: false,
      &quot;items&quot;: [
        {
          &quot;id&quot;: null,
          &quot;value&quot;: &quot;1&quot;,
          &quot;text&quot;: &quot;Да&quot;,
          &quot;img&quot;: &quot;&quot;
        },
        {
          &quot;id&quot;: null,
          &quot;value&quot;: &quot;0&quot;,
          &quot;text&quot;: &quot;Нет&quot;,
          &quot;img&quot;: &quot;&quot;
        }
      ]
    }
  }
}</code></pre>
        <h2 id="вопросы-к-тесту">Получение вопросов по одному: первый, следующй, предыдущий</h2>
        <p><strong>URL первый вопрос</strong> <code>GET /tests/api/v1/first/{test}/</code>
            <strong>URL следующий вопрос</strong> <code>GET /tests/api/v1/next/{test}/</code>
            <strong>URL предыдущий вопрос</strong> <code>GET /tests/api/v1/prev/{test}/</code></p>
        <h3 id="результат-1">Результат</h3>
        <ul>
            <li><strong>Код состояния:</strong> 200 ОК</li>
            <li><strong>Пример успешного ответа:</strong></li>
        </ul>
        <pre><code class="language-json">{
  &quot;question&quot;: {
    &quot;id&quot;: 1,
    &quot;type&quot;: &quot;option&quot;,
    &quot;name&quot;: &quot;Какая профессия Вам больше нравится?&quot;,
    &quot;text&quot;: null,
    &quot;img&quot;: null,
    &quot;count&quot;: null,
    &quot;gradient&quot;: 0,
    &quot;timer&quot;: 0,
    &quot;wrong&quot;: null,
    &quot;correct&quot;: null,
    &quot;enabledBack&quot;: true,
    &quot;enabledForward&quot;: false,
    &quot;showAnswer&quot;: false,
    &quot;items&quot;: [
      {
        &quot;id&quot;: null,
        &quot;value&quot;: &quot;q&quot;,
        &quot;text&quot;: &quot;Инженер&quot;,
        &quot;img&quot;: &quot;&quot;
      },
      {
        &quot;id&quot;: null,
        &quot;value&quot;: &quot;w&quot;,
        &quot;text&quot;: &quot;Социолог&quot;,
        &quot;img&quot;: &quot;&quot;
      }
    ]
  },
  &quot;number&quot;: 1,
  &quot;length&quot;: 42
}
</code></pre>
        <h2 id="сохранение-ответов-и-получение-result_key-1">Сохранение ответов и получение RESULT_KEY</h2>
        <p>Сохраняет ответы пользователя (прогресс - синоним) и возвращает идентификатор результата.</p>
        <p><strong>URL</strong>: <code>POST /partner/api/v3/progress/save</code></p>
        <h3 id="параметры">Параметры:</h3>
        <ul>
            <li><code>test</code> (обязательный): идентификатор теста. Этот параметр должен быть строкой.</li>
            <li><code>progress</code> (JSON, обязательный): ответы на вопросы. Пример: <code>[[&quot;1&quot;, [&quot;a&quot;]],
                    [&quot;2&quot;, [&quot;b&quot;, &quot;c&quot;]]]</code>. См. <a href="#param-progress-format">подробнее
                    о формате параметра</a>.
            </li>
        </ul>
        <h4 id="param-progress-format">Формат параметра "progress"</h4>
        <p>Структура параметра <code>progress</code> представляет собой JSON-массив, где каждый элемент — это массив,
            содержащий ID вопроса и массив ответов. Каждый элемент первого уровня представляет собой массив, в котором:
            Первый элемент — ID вопроса (строка).
            Второй элемент — массив ответов (строка), который может содержать несколько значений, так как некоторые
            вопросы могут иметь несколько допустимых вариантов ответа. Если вопрос пропущен, он должен быть представлен
            в списке с пустым массивом значений.</p>

        <h5>Пример с одним ответом на вопрос</h5>
        <p><code>[["1", ["a"]], ...]</code></p>
        <p>В этом примере мы видим, что вопрос id#1 имеет ответ "a".</p>

        <h5>Пример с несколькими ответами на вопрос</h5>
        <p><code>[["2", ["b", "c"]], ...]</code></p>
        <p>В этом примере мы видим, что вопрос id#2 имеет ответы "b" и "c".</p>

        <h5>Пример с пропущенным ответом на вопрос</h5>
        <p><code>[["3", []], ...]</code></p>
        <p>В этом примере мы видим, что вопрос id#3 не имеет ответов.</p>

        <h3 id="результат-2">Результат:</h3>
        <ul>
            <li><strong>Код состояния:</strong> 200 ОК</li>
            <li><strong>Пример успешного ответа:</strong></li>
        </ul>
        <pre><code class="language-json">{
  &quot;result_key&quot;: &quot;92f50432-dd78-4f57-b407-6bb273c78f62&quot;
}
</code></pre>
        <h2 id="ассоциация-результата-с-пользователем-1">Ассоциация результата с пользователем</h2>
        <p>Устанавливает связь пользователя с результатом и возвращает статус операции.</p>
        <p><strong>URL</strong>: <code>POST /partner/api/v3/result/attach</code></p>
        <h3 id="параметры-1">Параметры:</h3>
        <ul>
            <li><code>client_key</code> (обязательный): Секретный постоянный ключ вашего сайта, который вы получили при
                регистрации вашего
                сайта или приложения.
                Этот параметр должен быть строкой.
            </li>
            <li><code>user_id</code> (обязательный): уникальный идентификатор пользователя системы клиента, например id,
                email, sess_id. Этот
                параметр должен быть строкой.
            </li>
            <li><code>result_key</code> (обязательный): идентификатор результата. Этот параметр должен быть строкой.
            </li>
        </ul>
        <h3 id="результат-3">Результат:</h3>
        <ul>
            <li><strong>Код состояния:</strong> 200 ОК</li>
        </ul>
        <h3 id="возможные-ошибки">Возможные ошибки:</h3>
        <ul>
            <li>Не указаны обязательные параметры.</li>
            <li>Не найден пользователь.</li>
            <li>Не найден результат.</li>
            <li>Достигнут предел выданных доступов <a
                        href="#%D0%BF%D0%BB%D0%B0%D1%82%D1%91%D0%B6%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0">(см.
                    платёжная политика)</a>.
            </li>
            <li>Достигнут предел сохранённых результатов на одного пользователя <a
                        href="#%D0%BB%D0%B8%D1%86%D0%B5%D0%BD%D0%B7%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0">(см.
                    лицензионная политика)</a>.
            </li>
        </ul>
        <p><strong>Пример ошибки:</strong></p>
        <pre><code class="language-json">{
  &quot;error&quot;: {
    &quot;code&quot;: 404,
    &quot;message&quot;: &quot;User not found with the provided key.&quot;
  }
}
</code></pre>
        <h2 id="получение-результата-1">Получение результата</h2>
        <p><strong>URL</strong> <code>GET /partner/api/v3/result/get</code></p>
        <h3 id="параметры-2">Параметры:</h3>
        <ul>
            <li><code>result_key</code> (RESULT_KEY, обязательный): идентификатор результата. Этот параметр должен быть
                строкой.
            </li>
            <li><code>format</code> (обязательный): возможные значения: json, html, pdf.</li>
        </ul>
        <h3 id="результат-4">Результат:</h3>
        <ul>
            <li><strong>Код состояния:</strong> 200 ОК</li>
            <li><strong>Пример успешного ответа:</strong></li>
        </ul>
        <pre><code class="language-json">{
  &quot;VALUES&quot;: {
    &quot;it&quot;: {
      &quot;sum&quot;: 2,
      &quot;percentage&quot;: 20,
      &quot;percentage_value&quot;: 20
    },
    &quot;design&quot;: {
      &quot;sum&quot;: 8,
      &quot;percentage&quot;: 80,
      &quot;percentage_value&quot;: 80
    }
  }
}
</code></pre>


        <br/>
        <hr>
        <br/>

        <h1 id="widget">Интеграция html-виджета</h1>

        <p>Здесь описаны все возможные варианты интеграции вашего сайта с Тестодромом.</p>
        <p>На Тестодроме представлены как бесплатные, так и платные тесты. Это определяет различие в способе установки
            тестов на ваш сайт.</p>

        <h2>Интеграция бесплатного теста</h2>
        <code>
            <span>&lt;link href="https://cdn.jsdelivr.net/gh/davidtema/testonomica_widget/build/main.css" rel="stylesheet"&gt;<br/></span>
            <span>&lt;</span><span>div </span><span>id</span><span>="testonomica_app" </span><span>data-test</span><span>="{TEST_ID}"</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span><br/>
            <span>&lt;script src="https://cdn.jsdelivr.net/gh/davidtema/testonomica_widget/build/bundle.js"&gt;&lt;/script&gt;</span>
        </code>
        <br><br/>
        <h4>Определённая версия виджета</h4>
        <p>По умолчанию будет загружена последняя версия виджета. Однако если требуется, то вы можете указать
            определённую версию таким образом: <code>.../testonomica_widget@2.0.2/build/bundle.js</code></p>

        <hr>
        <br>

        <h2>Виды интеграции платного теста</h2>
        <ul>
            <li><a href="#igt">#Интеграция с переходом на Тестодром</a></li>
            <li><a href="#iw">#Интеграция через виджет на сайте</a></li>
        </ul>


        <p>Оба подхода предполагают изначально <a href="#gprt">#получение вами {SECRET_TOKEN}, {TEST_ID} и
                {SERVICE_NAME}</a> и последующее <a href="#gput">#получение {PUBLIC_TOKEN}</a> с этими параметрами.</p>

        <h3 id="gprt" class="mt-5">Получение {SECRET_TOKEN}, {TEST_ID} и {SERVICE_NAME}</h3>
        <p>Отправьте запрос нам на почту <a href="mailto:info@profguide.ru">info@profguide.ru</a>: укажите ваше имя,
            адрес сайта, какой тест вы планируете установить и предполагаемый способ приёма платежа.
            И мы вышлем ваш секретный токен {SECRET_TOKEN}, {TEST_ID} и {SERVICE_NAME},
            которые понадобятся для следующих шагов.</p>
        <div class="alert alert-warning">
            <b>Будьте внимательны!</b> {SECRET_TOKEN} не должен попасть третьим лицам.
        </div>

        <h3 id="gput" class="mt-5">Получение {PUBLIC_TOKEN}</h3>
        <p>{PUBLIC_TOKEN} &mdash; одноразовый публичный токен, который получается в скрытом запросе по URL (backend,
            curl). Конфигурацию URL должны знать только вы
            и она должна остаться в <b>тайне от третьих лиц</b>.</p>
        <code>
            https://testonomica.com/partner/api/token/?token={SECRETE_TOKEN}&user={USER_ID}&service={SERVICE_NAME}
        </code>
        <br/>
        <br/>
        <p>... где {USER_ID} - уникалный идентификатор пользователя на вашем сайте.</p>
        <p>
            Ответом будет одноразовый {PUBLIC_TOKEN} в формате JSON:<br/>
            <code>{"token":"cf738dd7-a138-4fa6-b3fd-52eef8ae2a92"}.</code><br>
        </p>

        <h4 class="mt-4">Вариант интеграции с приёмом платежа на вашей стороне:</h4>
        <p>Описанный выше пример получения токена предполагает последующий приём платежа Тестодром.
            Для приёма платежей на вашей стороне предусмотрен параметр <code>payment_type</code> со значением <code>external</code>:
        </p>
        <code>
            https://testonomica.com/partner/api/token/?token={SECRETE_TOKEN}&user={USER_ID}&service={SERVICE_NAME}&payment_type=external
        </code>
        <br><br>
        <p>Напишите нам на <a href="mailto:info@profguide.ru">info@profguide.ru</a>, чтобы получить специальное
            разрешение для приёма платежей на вашем сайте.</p>

        <h3 id="igt" class="mt-5">Интеграция с переходом на Тестодром</h3>
        <p><a href="https://www.profguide.io/test/testonomica-direct/">Демо</a>. Данный способ отображает тест не на
            вашем сайте, а на Тестодроме.</p>
        <p>Всё что нужно сделать - это направить пользователя по следующему URL с помощью редиректа или по кнопке на
            сайте:</p>
        <code>
            https://testonomica.com/partner/provide/?token={PUBLIC_TOKEN}
        </code>
        <br/>

        <hr>

        <h3 id="iw" class="mt-3">Интеграция через виджет на сайте</h3>
        <p><a href="https://www.profguide.io/test/testonomica-widget/">Демо</a>. Данный способ позволяет загрузить тест
            на вашем сайте в Iframe.</p>
        <p>Необходимо установить HTML-код в месте предполагаемого отображения теста и подставить полученные ранее
            параметры.</p>
        <code>
            <span>&lt;link href="https://cdn.jsdelivr.net/gh/davidtema/testonomica_widget/build/main.css" rel="stylesheet"&gt;<br/></span>
            <span>&lt;</span><span>div </span><span>id</span><span>="testonomica_app" </span><span>data-test</span><span>="{TEST_ID}" </span><span>data-token</span><span>="{PUBLIC_TOKEN}"</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span><br/>
            <span>&lt;script src="https://cdn.jsdelivr.net/gh/davidtema/testonomica_widget/build/bundle.js"&gt;&lt;/script&gt;</span>
        </code>
        <br/>

        <h4 class="mt-4">Конфигурация виджета</h4>
        <p>Все доступные варианты конфигурации вижета описаны на его <a
                    href="https://github.com/davidtema/testonomica_widget">официальной странице в GutHub</a>.</p>

        <hr>
        Напишите нам на <a href="mailto:info@profguide.ru">info@profguide.ru</a> если у вас остались вопросы или
        требуется помощь.

    </div>
{% endblock %}
