V2 писалась для интеграции с сайтом ставропольского колледжа.

Вот что изменилось по сравнению с предыдущими версиями.

- вводится регистрация пользователя (нужен id), взамен мы даём постоянный USER_TOKEN.
- введены политики (политика регистрации пользователей и политика сохранения результатов).
- происходит списание доступов (можно в минус, если политика работы с клиентским сайтом позволяет это)
- происходит учёт результатов пользователя ManyToMany (здесь могут быть введены ограничения в соостветствии с
  политикой работы с клиентским сайтом)

---

Вот как это выглядит на схеме.

1. Клиентский сайт (далее Провайдер) регистрируется в нашей системе
   и получает постоянный секретный токен сайта "CLIENT_KEY".
   Провайдер принимает политику оплаты: "Политика предоплаты" или "Политика постоплаты".
   Так же провайдера устанавливается лимит выдаваемых доступов для пользователей,
   если принята "Политика предоплаты".

2. Провайдер регистрирует своего пользователя на Тестодроме по API и получает постоянный USER_KEY пользователя.
   При этом происходит увеличение числа выданных провайдеру доступов на единицу.
   Повторный запрос возвращает USER_KEY найденного пользователя, а счётчик доступов не увеличивается.
   Перед регистрацией пользователя происходит проверка на достижение лимита выданных доступов,
   если компания приняла политику предоплаты.
   При политике постоплаты лимит выданных доступов значения не имеет.

3. Перед показом теста клиентский сайт запрашивает одноразовый токен ACCESS_TOKEN (как сейчас).
   Надо только удалять старые токены. Допустим, срок жизни токена - 24 часа.

4. Когда вопросник пройден, провайдер передаёт нам по USER_KEY и ответы, чтобы сохранить результаты и
   получить ключ результата RESULT_KEY.
   Здесь мы сверяемся с другой политикой - "Политикой Тестов".
   Так мы проверям прогресс каких тестов этот пользователь уже сохранил. Если ещё не сохранил, то мы позволяем ему это
   сделать.
   "Политика тестов" для различных сайтов может быть разная. Одним мы можем предоставлять по одному
   доступу только один тест, другому тест + бонус. Третьему сайту разрешено сохранять более одного результата одного
   теста для одного пользователя.

Эта схема так же хороша, потому что позволит проверять USER_KEY по API - какие тесты пройдены, какие
доступны, и сколько есть доступов и список USER_KEY, их результаты.

----

Пишу документацию:

# API Documentation

## Регистрация пользователя

Регистрирует пользователя на Тестодроме и увеличивает счётчик выданных доступов на один. Повторно пользователь не
создаётся и счётик не увеличивается.

**URL**: `GET /partner/api/v2/user/register`

### Параметры:

- `client` (обязательный): Секретный постоянный токен вашего сайта, который вы получили при регистрации вашего сайта.
  Этот параметр должен быть строкой.
- `user_id` (обязательный): уникальный идентификатор пользователя в вашей системе, например, id или email. Этот параметр
  должен быть строкой.

### Результат:

- **Код состояния:** 200 ОК
- **Пример успешного ответа:**

```json
{
  "user_key": "92f50432-dd78-4f57-b407-6bb273c78f62"
}
```

### Возможные ошибки:

- Не указаны обязательные параметры.
- Клиент не найден по указанному токену.
- Достигнут предел выданных доступов.

**Пример ошибки:**

```json
{
  "error": {
    "code": 404,
    "message": "Client not found with the provided token."
  }
}
```